---
  - name: install wireguard
    apt: 
      name:
      - wireguard
      state: present
      update_cache: true

  - name: copy wg config files
    copy: 
      src: "{{root_dir}}/{{instanceName}}/wg0.conf"
      dest: '/etc/wireguard/wg0.conf'

  - name: Inline broker id
    lineinfile:
      path: /etc/wireguard/wg0.conf
      regexp: '^Endpoint'
      line: "Endpoint = {{wireguardIP}}:55555"

  - name: run a wireguard quick-up service
    systemd:
      name: wg-quick@wg0.service
      state: restarted
      enabled: yes
